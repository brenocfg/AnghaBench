#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */
typedef  struct TYPE_5__   TYPE_1__ ;

/* Type definitions */
typedef  scalar_t__ kern_return_t ;
typedef  int /*<<< orphan*/  io_service_t ;
struct TYPE_5__ {scalar_t__ (* QueryInterface ) (TYPE_1__**,int /*<<< orphan*/ ,int /*<<< orphan*/ *) ;int /*<<< orphan*/  (* Release ) (TYPE_1__**) ;} ;
typedef  int /*<<< orphan*/  SInt32 ;
typedef  int /*<<< orphan*/  LPVOID ;
typedef  int /*<<< orphan*/  IOUSBDeviceInterface ;
typedef  TYPE_1__ IOCFPlugInInterface ;

/* Variables and functions */
 int /*<<< orphan*/  CFUUIDGetUUIDBytes (int /*<<< orphan*/ ) ; 
 scalar_t__ IOCreatePlugInInterfaceForService (int /*<<< orphan*/ ,int /*<<< orphan*/ ,int /*<<< orphan*/ ,TYPE_1__***,int /*<<< orphan*/ *) ; 
 int KERN_FAILURE ; 
 scalar_t__ KERN_SUCCESS ; 
 int /*<<< orphan*/  kIOCFPlugInInterfaceID ; 
 scalar_t__ kIOReturnSuccess ; 
 int /*<<< orphan*/  kIOUSBDeviceInterfaceID ; 
 int /*<<< orphan*/  kIOUSBDeviceUserClientTypeID ; 
 scalar_t__ stub1 (TYPE_1__**,int /*<<< orphan*/ ,int /*<<< orphan*/ *) ; 
 int /*<<< orphan*/  stub2 (TYPE_1__**) ; 

__attribute__((used)) static int get_usbdevice_handle(io_service_t device, IOUSBDeviceInterface* dev){

    kern_return_t err = KERN_SUCCESS;
    SInt32 score;
    IOCFPlugInInterface** plugInInterface = NULL;
    
    err = IOCreatePlugInInterfaceForService(device,
                                            kIOUSBDeviceUserClientTypeID,
                                            kIOCFPlugInInterfaceID,
                                            &plugInInterface, &score);
    
    if (err != KERN_SUCCESS || plugInInterface == NULL)
        return err;
    
    err = (*plugInInterface)->QueryInterface(plugInInterface, CFUUIDGetUUIDBytes(kIOUSBDeviceInterfaceID), (LPVOID*)dev);
    
    if(err != kIOReturnSuccess)
        return err;
    
    // Now done with the plugin interface.
    (*plugInInterface)->Release(plugInInterface);
    //plugInInterface = NULL;
    
    if(!dev)
        return KERN_FAILURE;
    
    return err;
}