#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */

/* Type definitions */
struct sockaddr_nl {int idiag_ext; int nlmsg_flags; int msg_namelen; int msg_iovlen; struct iovec* msg_iov; void* msg_name; int /*<<< orphan*/  nlmsg_type; int /*<<< orphan*/  nlmsg_len; int /*<<< orphan*/  idiag_states; int /*<<< orphan*/  sdiag_protocol; int /*<<< orphan*/  sdiag_family; int /*<<< orphan*/  nl_family; } ;
struct rtattr {int dummy; } ;
struct nlmsghdr {int idiag_ext; int nlmsg_flags; int msg_namelen; int msg_iovlen; struct iovec* msg_iov; void* msg_name; int /*<<< orphan*/  nlmsg_type; int /*<<< orphan*/  nlmsg_len; int /*<<< orphan*/  idiag_states; int /*<<< orphan*/  sdiag_protocol; int /*<<< orphan*/  sdiag_family; int /*<<< orphan*/  nl_family; } ;
struct msghdr {int idiag_ext; int nlmsg_flags; int msg_namelen; int msg_iovlen; struct iovec* msg_iov; void* msg_name; int /*<<< orphan*/  nlmsg_type; int /*<<< orphan*/  nlmsg_len; int /*<<< orphan*/  idiag_states; int /*<<< orphan*/  sdiag_protocol; int /*<<< orphan*/  sdiag_family; int /*<<< orphan*/  nl_family; } ;
struct iovec {int iov_len; void* iov_base; } ;
struct inet_diag_req_v2 {int idiag_ext; int nlmsg_flags; int msg_namelen; int msg_iovlen; struct iovec* msg_iov; void* msg_name; int /*<<< orphan*/  nlmsg_type; int /*<<< orphan*/  nlmsg_len; int /*<<< orphan*/  idiag_states; int /*<<< orphan*/  sdiag_protocol; int /*<<< orphan*/  sdiag_family; int /*<<< orphan*/  nl_family; } ;
typedef  int /*<<< orphan*/  sa ;
typedef  int /*<<< orphan*/  nlh ;
typedef  int /*<<< orphan*/  msg ;
typedef  int /*<<< orphan*/  conn_req ;

/* Variables and functions */
 int /*<<< orphan*/  AF_INET ; 
 int /*<<< orphan*/  AF_NETLINK ; 
 int INET_DIAG_INFO ; 
 int /*<<< orphan*/  IPPROTO_SCTP ; 
 int /*<<< orphan*/  NLMSG_LENGTH (int) ; 
 int NLM_F_DUMP ; 
 int NLM_F_REQUEST ; 
 int /*<<< orphan*/  SCTP_SS_CLOSED ; 
 int /*<<< orphan*/  SOCK_DIAG_BY_FAMILY ; 
 int /*<<< orphan*/  free (void*) ; 
 int /*<<< orphan*/  memset (struct sockaddr_nl*,int /*<<< orphan*/ ,int) ; 
 int sendmsg (int,struct sockaddr_nl*,int /*<<< orphan*/ ) ; 

int send_diag_msg(int sockfd){
    struct msghdr msg;
    struct nlmsghdr nlh;
    struct inet_diag_req_v2 conn_req;
    struct sockaddr_nl sa;
    struct iovec iov[4];
    int retval = 0;

    //For the filter
    struct rtattr rta;
    void *filter_mem = NULL;
    int filter_len = 0;

    memset(&msg, 0, sizeof(msg));
    memset(&sa, 0, sizeof(sa));
    memset(&nlh, 0, sizeof(nlh));
    memset(&conn_req, 0, sizeof(conn_req));

    sa.nl_family = AF_NETLINK;

    conn_req.sdiag_family = AF_INET;
    conn_req.sdiag_protocol = IPPROTO_SCTP;
    conn_req.idiag_states = SCTP_SS_CLOSED;
    conn_req.idiag_ext |= (1 << (INET_DIAG_INFO - 1));
    
    nlh.nlmsg_len = NLMSG_LENGTH(sizeof(conn_req));
    nlh.nlmsg_flags = NLM_F_DUMP | NLM_F_REQUEST;

    nlh.nlmsg_type = SOCK_DIAG_BY_FAMILY;
    iov[0].iov_base = (void*) &nlh;
    iov[0].iov_len = sizeof(nlh);
    iov[1].iov_base = (void*) &conn_req;
    iov[1].iov_len = sizeof(conn_req);

    //Set essage correctly
    msg.msg_name = (void*) &sa;
    msg.msg_namelen = sizeof(sa);
    msg.msg_iov = iov;
    if(filter_mem == NULL)
        msg.msg_iovlen = 2;
    else
        msg.msg_iovlen = 4;
   
    retval = sendmsg(sockfd, &msg, 0);

    if(filter_mem != NULL)
        free(filter_mem);

    return retval;
}