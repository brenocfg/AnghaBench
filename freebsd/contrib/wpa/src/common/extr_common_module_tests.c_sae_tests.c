#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */
typedef  struct TYPE_2__   TYPE_1__ ;

/* Type definitions */
typedef  int u8 ;
struct wpabuf {scalar_t__ used; } ;
struct sae_data {int const* pmk; int const* pmkid; int send_confirm; TYPE_1__* tmp; } ;
struct crypto_bignum {int dummy; } ;
typedef  int /*<<< orphan*/  sae ;
typedef  int /*<<< orphan*/  peer_confirm ;
typedef  int /*<<< orphan*/  peer_commit ;
typedef  int /*<<< orphan*/  local_rand ;
typedef  int /*<<< orphan*/  local_mask ;
typedef  int /*<<< orphan*/  local_confirm ;
typedef  int /*<<< orphan*/  local_commit ;
struct TYPE_2__ {int const* kck; int /*<<< orphan*/  own_commit_element_ecc; int /*<<< orphan*/  ec; int /*<<< orphan*/  pwe_ecc; int /*<<< orphan*/  own_commit_scalar; int /*<<< orphan*/  order; struct crypto_bignum* sae_rand; } ;

/* Variables and functions */
 int ETH_ALEN ; 
 int /*<<< orphan*/  MSG_DEBUG ; 
 int /*<<< orphan*/  MSG_ERROR ; 
 int SAE_KCK_LEN ; 
 int SAE_PMKID_LEN ; 
 int SAE_PMK_LEN ; 
 scalar_t__ crypto_bignum_add (struct crypto_bignum*,struct crypto_bignum*,int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  crypto_bignum_deinit (struct crypto_bignum*,int) ; 
 void* crypto_bignum_init_set (int const*,int) ; 
 scalar_t__ crypto_bignum_mod (int /*<<< orphan*/ ,int /*<<< orphan*/ ,int /*<<< orphan*/ ) ; 
 scalar_t__ crypto_ec_point_invert (int /*<<< orphan*/ ,int /*<<< orphan*/ ) ; 
 scalar_t__ crypto_ec_point_mul (int /*<<< orphan*/ ,int /*<<< orphan*/ ,struct crypto_bignum*,int /*<<< orphan*/ ) ; 
 scalar_t__ os_memcmp (int const*,int const*,int) ; 
 int /*<<< orphan*/  os_memset (struct sae_data*,int /*<<< orphan*/ ,int) ; 
 int /*<<< orphan*/  os_strlen (char const*) ; 
 scalar_t__ sae_check_confirm (struct sae_data*,int const*,int) ; 
 int /*<<< orphan*/  sae_clear_data (struct sae_data*) ; 
 scalar_t__ sae_parse_commit (struct sae_data*,int const*,int,int /*<<< orphan*/ *,int /*<<< orphan*/ *,int /*<<< orphan*/ *) ; 
 scalar_t__ sae_prepare_commit (int const*,int const*,int const*,int /*<<< orphan*/ ,char const*,struct sae_data*) ; 
 scalar_t__ sae_process_commit (struct sae_data*) ; 
 scalar_t__ sae_set_group (struct sae_data*,int) ; 
 int /*<<< orphan*/  sae_write_commit (struct sae_data*,struct wpabuf*,int /*<<< orphan*/ *,char const*) ; 
 int /*<<< orphan*/  sae_write_confirm (struct sae_data*,struct wpabuf*) ; 
 int /*<<< orphan*/  wpa_hexdump_buf (int /*<<< orphan*/ ,char*,struct wpabuf*) ; 
 int /*<<< orphan*/  wpa_printf (int /*<<< orphan*/ ,char*) ; 
 struct wpabuf* wpabuf_alloc (int) ; 
 int /*<<< orphan*/  wpabuf_free (struct wpabuf*) ; 
 int const* wpabuf_head (struct wpabuf*) ; 
 int wpabuf_len (struct wpabuf*) ; 

__attribute__((used)) static int sae_tests(void)
{
#ifdef CONFIG_SAE
	struct sae_data sae;
	int ret = -1;
	/* IEEE P802.11-REVmd/D2.1, Annex J.10 */
	const u8 addr1[ETH_ALEN] = { 0x82, 0x7b, 0x91, 0x9d, 0xd4, 0xb9 };
	const u8 addr2[ETH_ALEN] = { 0x1e, 0xec, 0x49, 0xea, 0x64, 0x88 };
	const char *pw = "mekmitasdigoat";
	const char *pwid = "psk4internet";
	const u8 local_rand[] = {
		0xa9, 0x06, 0xf6, 0x1e, 0x4d, 0x3a, 0x5d, 0x4e,
		0xb2, 0x96, 0x5f, 0xf3, 0x4c, 0xf9, 0x17, 0xdd,
		0x04, 0x44, 0x45, 0xc8, 0x78, 0xc1, 0x7c, 0xa5,
		0xd5, 0xb9, 0x37, 0x86, 0xda, 0x9f, 0x83, 0xcf
	};
	const u8 local_mask[] = {
		0x42, 0x34, 0xb4, 0xfb, 0x17, 0xaa, 0x43, 0x5c,
		0x52, 0xfb, 0xfd, 0xeb, 0xe6, 0x40, 0x39, 0xb4,
		0x34, 0x78, 0x20, 0x0e, 0x54, 0xff, 0x7b, 0x6e,
		0x07, 0xb6, 0x9c, 0xad, 0x74, 0x15, 0x3c, 0x15
	};
	const u8 local_commit[] = {
		0x13, 0x00, 0xeb, 0x3b, 0xab, 0x19, 0x64, 0xe4,
		0xa0, 0xab, 0x05, 0x92, 0x5d, 0xdf, 0x33, 0x39,
		0x51, 0x91, 0x38, 0xbc, 0x65, 0xd6, 0xcd, 0xc0,
		0xf8, 0x13, 0xdd, 0x6f, 0xd4, 0x34, 0x4e, 0xb4,
		0xbf, 0xe4, 0x4b, 0x5c, 0x21, 0x59, 0x76, 0x58,
		0xf4, 0xe3, 0xed, 0xdf, 0xb4, 0xb9, 0x9f, 0x25,
		0xb4, 0xd6, 0x54, 0x0f, 0x32, 0xff, 0x1f, 0xd5,
		0xc5, 0x30, 0xc6, 0x0a, 0x79, 0x44, 0x48, 0x61,
		0x0b, 0xc6, 0xde, 0x3d, 0x92, 0xbd, 0xbb, 0xd4,
		0x7d, 0x93, 0x59, 0x80, 0xca, 0x6c, 0xf8, 0x98,
		0x8a, 0xb6, 0x63, 0x0b, 0xe6, 0x76, 0x4c, 0x88,
		0x5c, 0xeb, 0x97, 0x93, 0x97, 0x0f, 0x69, 0x52,
		0x17, 0xee, 0xff, 0x0d, 0x21, 0x70, 0x73, 0x6b,
		0x34, 0x69, 0x6e, 0x74, 0x65, 0x72, 0x6e, 0x65,
		0x74
	};
	const u8 peer_commit[] = {
		0x13, 0x00, 0x55, 0x64, 0xf0, 0x45, 0xb2, 0xea,
		0x1e, 0x56, 0x6c, 0xf1, 0xdd, 0x74, 0x1f, 0x70,
		0xd9, 0xbe, 0x35, 0xd2, 0xdf, 0x5b, 0x9a, 0x55,
		0x02, 0x94, 0x6e, 0xe0, 0x3c, 0xf8, 0xda, 0xe2,
		0x7e, 0x1e, 0x05, 0xb8, 0x43, 0x0e, 0xb7, 0xa9,
		0x9e, 0x24, 0x87, 0x7c, 0xe6, 0x9b, 0xaf, 0x3d,
		0xc5, 0x80, 0xe3, 0x09, 0x63, 0x3d, 0x6b, 0x38,
		0x5f, 0x83, 0xee, 0x1c, 0x3e, 0xc3, 0x59, 0x1f,
		0x1a, 0x53, 0x93, 0xc0, 0x6e, 0x80, 0x5d, 0xdc,
		0xeb, 0x2f, 0xde, 0x50, 0x93, 0x0d, 0xd7, 0xcf,
		0xeb, 0xb9, 0x87, 0xc6, 0xff, 0x96, 0x66, 0xaf,
		0x16, 0x4e, 0xb5, 0x18, 0x4d, 0x8e, 0x66, 0x62,
		0xed, 0x6a, 0xff, 0x0d, 0x21, 0x70, 0x73, 0x6b,
		0x34, 0x69, 0x6e, 0x74, 0x65, 0x72, 0x6e, 0x65,
		0x74
	};
	const u8 kck[] = {
		0x59, 0x9d, 0x6f, 0x1e, 0x27, 0x54, 0x8b, 0xe8,
		0x49, 0x9d, 0xce, 0xed, 0x2f, 0xec, 0xcf, 0x94,
		0x81, 0x8c, 0xe1, 0xc7, 0x9f, 0x1b, 0x4e, 0xb3,
		0xd6, 0xa5, 0x32, 0x28, 0xa0, 0x9b, 0xf3, 0xed
	};
	const u8 pmk[] = {
		0x7a, 0xea, 0xd8, 0x6f, 0xba, 0x4c, 0x32, 0x21,
		0xfc, 0x43, 0x7f, 0x5f, 0x14, 0xd7, 0x0d, 0x85,
		0x4e, 0xa5, 0xd5, 0xaa, 0xc1, 0x69, 0x01, 0x16,
		0x79, 0x30, 0x81, 0xed, 0xa4, 0xd5, 0x57, 0xc5
	};
	const u8 pmkid[] = {
		0x40, 0xa0, 0x9b, 0x60, 0x17, 0xce, 0xbf, 0x00,
		0x72, 0x84, 0x3b, 0x53, 0x52, 0xaa, 0x2b, 0x4f
	};
	const u8 local_confirm[] = {
		0x01, 0x00, 0x12, 0xd9, 0xd5, 0xc7, 0x8c, 0x50,
		0x05, 0x26, 0xd3, 0x6c, 0x41, 0xdb, 0xc5, 0x6a,
		0xed, 0xf2, 0x91, 0x4c, 0xed, 0xdd, 0xd7, 0xca,
		0xd4, 0xa5, 0x8c, 0x48, 0xf8, 0x3d, 0xbd, 0xe9,
		0xfc, 0x77
	};
	const u8 peer_confirm[] = {
		0x01, 0x00, 0x02, 0x87, 0x1c, 0xf9, 0x06, 0x89,
		0x8b, 0x80, 0x60, 0xec, 0x18, 0x41, 0x43, 0xbe,
		0x77, 0xb8, 0xc0, 0x8a, 0x80, 0x19, 0xb1, 0x3e,
		0xb6, 0xd0, 0xae, 0xf0, 0xd8, 0x38, 0x3d, 0xfa,
		0xc2, 0xfd
	};
	struct wpabuf *buf = NULL;
	struct crypto_bignum *mask = NULL;

	os_memset(&sae, 0, sizeof(sae));
	buf = wpabuf_alloc(1000);
	if (!buf ||
	    sae_set_group(&sae, 19) < 0 ||
	    sae_prepare_commit(addr1, addr2, (const u8 *) pw, os_strlen(pw),
			       pwid, &sae) < 0)
		goto fail;

	/* Override local values based on SAE test vector */
	crypto_bignum_deinit(sae.tmp->sae_rand, 1);
	sae.tmp->sae_rand = crypto_bignum_init_set(local_rand,
						   sizeof(local_rand));
	mask = crypto_bignum_init_set(local_mask, sizeof(local_mask));
	if (!sae.tmp->sae_rand || !mask)
		goto fail;

	if (crypto_bignum_add(sae.tmp->sae_rand, mask,
			      sae.tmp->own_commit_scalar) < 0 ||
	    crypto_bignum_mod(sae.tmp->own_commit_scalar, sae.tmp->order,
			      sae.tmp->own_commit_scalar) < 0 ||
	    crypto_ec_point_mul(sae.tmp->ec, sae.tmp->pwe_ecc, mask,
				sae.tmp->own_commit_element_ecc) < 0 ||
	    crypto_ec_point_invert(sae.tmp->ec,
				   sae.tmp->own_commit_element_ecc) < 0)
		goto fail;

	/* Check that output matches the test vector */
	sae_write_commit(&sae, buf, NULL, pwid);
	wpa_hexdump_buf(MSG_DEBUG, "SAE: Commit message", buf);

	if (wpabuf_len(buf) != sizeof(local_commit) ||
	    os_memcmp(wpabuf_head(buf), local_commit,
		      sizeof(local_commit)) != 0) {
		wpa_printf(MSG_ERROR, "SAE: Mismatch in local commit");
		goto fail;
	}

	if (sae_parse_commit(&sae, peer_commit, sizeof(peer_commit), NULL, NULL,
		    NULL) != 0 ||
	    sae_process_commit(&sae) < 0)
		goto fail;

	if (os_memcmp(kck, sae.tmp->kck, SAE_KCK_LEN) != 0) {
		wpa_printf(MSG_ERROR, "SAE: Mismatch in KCK");
		goto fail;
	}

	if (os_memcmp(pmk, sae.pmk, SAE_PMK_LEN) != 0) {
		wpa_printf(MSG_ERROR, "SAE: Mismatch in PMK");
		goto fail;
	}

	if (os_memcmp(pmkid, sae.pmkid, SAE_PMKID_LEN) != 0) {
		wpa_printf(MSG_ERROR, "SAE: Mismatch in PMKID");
		goto fail;
	}

	buf->used = 0;
	sae.send_confirm = 1;
	sae_write_confirm(&sae, buf);
	wpa_hexdump_buf(MSG_DEBUG, "SAE: Confirm message", buf);

	if (wpabuf_len(buf) != sizeof(local_confirm) ||
	    os_memcmp(wpabuf_head(buf), local_confirm,
		      sizeof(local_confirm)) != 0) {
		wpa_printf(MSG_ERROR, "SAE: Mismatch in local confirm");
		goto fail;
	}

	if (sae_check_confirm(&sae, peer_confirm, sizeof(peer_confirm)) < 0)
		goto fail;

	ret = 0;
fail:
	sae_clear_data(&sae);
	wpabuf_free(buf);
	crypto_bignum_deinit(mask, 1);
	return ret;
#else /* CONFIG_SAE */
	return 0;
#endif /* CONFIG_SAE */
}